generator client {
  provider  = "prisma-client-js"
  output    = "../src/generated/prisma"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

enum UserRole {
  ADMIN
  GURU
  SISWA
}

enum MapelCategory {
  WAJIB
  MUATAN_LOKAL
  EKSTRAKURIKULER
}

enum NilaiKomponenType {
  INPUT
  READ_ONLY
}

enum AbsensiStatus {
  HADIR
  SAKIT
  IZIN
  ALPHA
}

model User {
  id              String       @id @default(uuid())
  username        String       @unique
  passwordHash    String
  role            UserRole
  isWaliKelas     Boolean      @default(false)
  createdAt       DateTime     @default(now())
  updatedAt       DateTime     @updatedAt
  deletedAt       DateTime?
  admin           Admin?
  guru            Guru?
  siswa           Siswa?
  Pengumuman      Pengumuman[]

  dokumens Dokumen[]
}

model Admin {
  id              String           @id @default(uuid())
  userId          String           @unique
  user            User             @relation(fields: [userId], references: [id])
  nama            String
  email           String?          @unique
  SekolahData     SekolahData[]
  Ruangan         Ruangan[]
  TingkatanKelas  TingkatanKelas[]
  TahunAjaran     TahunAjaran[]
  MataPelajaran   MataPelajaran[]

  skemaPenilaians SkemaPenilaian[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  deletedAt DateTime?
}

model Guru {
  id              String               @id @default(uuid())
  userId          String               @unique
  user            User                 @relation(fields: [userId], references: [id])
  nip             String?              @unique
  nama            String
  email           String?              @unique
  jenisKelamin    String?
  agama           String?
  tempatLahir     String?
  tanggalLahir    DateTime?
  noTelp          String?
  nik             String?
  nuptk           String?
  statusKepegawaian String?
  alamat          String?
  isAktif         Boolean              @default(true)
  KelasBimbingan  Kelas?
  Penugasan       PenugasanGuru[]
  Jadwal          Jadwal[]
  AbsensiSesi     AbsensiSesi[]
  NilaiInput      NilaiDetailSiswa[]
  CapaianInput    CapaianKompetensi[]
  RaporDiurus     Rapor[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  deletedAt DateTime?
}

model Siswa {
  id              String               @id @default(uuid())
  userId          String               @unique
  user            User                 @relation(fields: [userId], references: [id])
  nisn            String               @unique
  nama            String
  jenisKelamin    String?
  agama           String?
  tempatLahir     String?
  tanggalLahir    DateTime?
  pendidikanSebelumnya String?
  alamat          String?
  namaAyah        String?
  pekerjaanAyah   String?
  namaIbu         String?
  pekerjaanIbu    String?
  alamatOrtu      String?
  namaWali        String?
  pekerjaanWali   String?
  alamatWali      String?
  status          String?              @default("Aktif")
  nik             String?
  Penempatan      PenempatanSiswa[]
  AbsensiDetail   AbsensiDetail[]
  Rapor           Rapor[]
  NilaiDiperoleh  NilaiDetailSiswa[]
  CapaianDiperoleh CapaianKompetensi[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  deletedAt DateTime?
}

model SekolahData {
  id              String       @id @default(uuid())
  adminId         String
  admin           Admin        @relation(fields: [adminId], references: [id])
  namaSekolah     String
  alamat          String?
  kepalaSekolah   String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  deletedAt DateTime?
}

model TahunAjaran {
  id              String           @id @default(uuid())
  adminId         String
  admin           Admin            @relation(fields: [adminId], references: [id])
  nama            String           @unique
  isAktif         Boolean          @default(false)
  Penempatan      PenempatanSiswa[]
  Jadwal          Jadwal[]

  rapors Rapor[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  deletedAt DateTime?
}

model TingkatanKelas {
  id              String           @id @default(uuid())
  adminId         String
  admin           Admin            @relation(fields: [adminId], references: [id])
  namaTingkat     String           @unique
  Kelas           Kelas[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  deletedAt DateTime?
}

model Ruangan {
  id              String       @id @default(uuid())
  adminId         String
  admin           Admin        @relation(fields: [adminId], references: [id])
  namaRuangan     String       @unique
  kapasitas       Int?
  Jadwal          Jadwal[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  deletedAt DateTime?
}

model Kelas {
  id              String           @id @default(uuid())
  namaKelas       String
  tingkatanId     String
  tingkatan       TingkatanKelas   @relation(fields: [tingkatanId], references: [id])
  waliKelasId     String?          @unique
  waliKelas       Guru?            @relation(fields: [waliKelasId], references: [id])
  Penempatan      PenempatanSiswa[]
  Jadwal          Jadwal[]

  penugasanGurus PenugasanGuru[]

  absensiSesis AbsensiSesi[]

  rapors Rapor[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  deletedAt DateTime?
}

model PenempatanSiswa {
  id              String       @id @default(uuid())
  siswaId         String
  siswa           Siswa        @relation(fields: [siswaId], references: [id])
  kelasId         String
  kelas           Kelas        @relation(fields: [kelasId], references: [id])
  tahunAjaranId   String
  tahunAjaran     TahunAjaran  @relation(fields: [tahunAjaranId], references: [id])

  @@unique([siswaId, tahunAjaranId])

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  deletedAt DateTime?
}

model MataPelajaran {
  id              String           @id @default(uuid())
  adminId         String
  admin           Admin            @relation(fields: [adminId], references: [id])
  namaMapel       String
  kategori        MapelCategory
  Penugasan       PenugasanGuru[]
  SkemaPenilaian  SkemaPenilaian[]

  jadwals Jadwal[]

  nilaiDetailSiswas NilaiDetailSiswa[]

  capaianKompetensis CapaianKompetensi[]

  nilaiRaporAkhirs NilaiRaporAkhir[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  deletedAt DateTime?
}

model PenugasanGuru {
  id              String           @id @default(uuid())
  guruId          String
  guru            Guru             @relation(fields: [guruId], references: [id])
  mapelId         String
  mapel           MataPelajaran    @relation(fields: [mapelId], references: [id])
  kelasId         String
  kelas           Kelas            @relation(fields: [kelasId], references: [id])

  @@unique([guruId, mapelId, kelasId])

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  deletedAt DateTime?
}

model SkemaPenilaian {
  id              String       @id @default(uuid())
  adminId         String
  admin           Admin        @relation(fields: [adminId], references: [id])
  mapelId         String
  mapel           MataPelajaran @relation(fields: [mapelId], references: [id])
  Komponen        NilaiKomponen[]

  @@unique([mapelId])

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  deletedAt DateTime?
}

model NilaiKomponen {
  id              String               @id @default(uuid())
  skemaId         String
  skema           SkemaPenilaian       @relation(fields: [skemaId], references: [id])
  namaKomponen    String
  tipe            NilaiKomponenType
  formula         String?
  urutan          Int
  NilaiDetail     NilaiDetailSiswa[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  deletedAt DateTime?
}

model Jadwal {
  id              String       @id @default(uuid())
  tahunAjaranId   String
  tahunAjaran     TahunAjaran  @relation(fields: [tahunAjaranId], references: [id])
  kelasId         String
  kelas           Kelas        @relation(fields: [kelasId], references: [id])
  mapelId         String
  mapel           MataPelajaran @relation(fields: [mapelId], references: [id])
  guruId          String
  guru            Guru         @relation(fields: [guruId], references: [id])
  ruanganId       String
  ruangan         Ruangan      @relation(fields: [ruanganId], references: [id])
  hari            String
  waktuMulai      String
  waktuSelesai    String

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  deletedAt DateTime?
}

model AbsensiSesi {
  id              String       @id @default(uuid())
  guruId          String
  guru            Guru         @relation(fields: [guruId], references: [id])
  kelasId         String
  kelas           Kelas        @relation(fields: [kelasId], references: [id])
  tanggal         DateTime
  pertemuanKe     Int
  Detail          AbsensiDetail[]

  @@unique([kelasId, tanggal, pertemuanKe])

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  deletedAt DateTime?
}

model AbsensiDetail {
  id              String          @id @default(uuid())
  siswaId         String
  siswa           Siswa           @relation(fields: [siswaId], references: [id])
  sesiId          String
  sesi            AbsensiSesi     @relation(fields: [sesiId], references: [id])
  status          AbsensiStatus

  @@unique([siswaId, sesiId])

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  deletedAt DateTime?
}

model NilaiDetailSiswa {
  id              String               @id @default(uuid())
  siswaId         String
  siswa           Siswa                @relation(fields: [siswaId], references: [id])
  mapelId         String
  mapel           MataPelajaran        @relation(fields: [mapelId], references: [id])
  komponenId      String?
  komponen        NilaiKomponen?       @relation(fields: [komponenId], references: [id])
  guruId          String
  guru            Guru                 @relation(fields: [guruId], references: [id])
  nilaiAngka      Float?
  nilaiDeskripsi  String?

  @@unique([siswaId, mapelId, komponenId])

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  deletedAt DateTime?
}

model CapaianKompetensi {
  id              String       @id @default(uuid())
  siswaId         String
  siswa           Siswa        @relation(fields: [siswaId], references: [id])
  mapelId         String
  mapel           MataPelajaran @relation(fields: [mapelId], references: [id])
  guruId          String
  guru            Guru         @relation(fields: [guruId], references: [id])
  deskripsi       String

  @@unique([siswaId, mapelId])

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  deletedAt DateTime?
}


model Rapor {
  id              String       @id @default(uuid())
  siswaId         String
  siswa           Siswa        @relation(fields: [siswaId], references: [id])
  kelasId         String
  kelas           Kelas        @relation(fields: [kelasId], references: [id])
  tahunAjaranId   String
  tahunAjaran     TahunAjaran  @relation(fields: [tahunAjaranId], references: [id])
  waliKelasId     String
  waliKelas       Guru         @relation(fields: [waliKelasId], references: [id])
  catatanWaliKelas String?
  dataKokurikuler String?
  isFinalisasi    Boolean      @default(false)
  NilaiRaporAkhir NilaiRaporAkhir[]

  @@unique([siswaId, tahunAjaranId])

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  deletedAt DateTime?
}

model NilaiRaporAkhir {
  id              String       @id @default(uuid())
  raporId         String
  rapor           Rapor        @relation(fields: [raporId], references: [id])
  mapelId         String
  mapel           MataPelajaran @relation(fields: [mapelId], references: [id])
  nilaiAkhir      Float?
  isOverride      Boolean      @default(false)

  @@unique([raporId, mapelId])

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  deletedAt DateTime?
}

model Dokumen {
  id              String       @id @default(uuid())
  adminId         String
  admin           User         @relation(fields: [adminId], references: [id])
  judul           String
  urlFile         String
  createdAt       DateTime     @default(now())
  updatedAt       DateTime     @updatedAt
  deletedAt       DateTime?
}

model Pengumuman {
  id              String       @id @default(uuid())
  adminId         String
  admin           User         @relation(fields: [adminId], references: [id])
  judul           String
  konten          String
  target          String       @default("SEMUA")
  tanggalPublikasi DateTime    @default(now())
  createdAt       DateTime     @default(now())
  updatedAt       DateTime     @updatedAt
  deletedAt       DateTime?
}